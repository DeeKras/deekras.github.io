<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>DeeKras.com</title>
    <meta name="description" content="">
    <meta name="author" content="Dee Kras">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://www.deekras.com/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://www.deekras.com/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://www.deekras.com/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://www.deekras.com/theme/local.css" rel="stylesheet">
    <link href="http://www.deekras.com/theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="feeds/all.atom.xml" rel="alternate" title="DeeKras.com" type="application/atom+xml">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://www.deekras.com">DeeKras.com</a>

        <div class="nav-collapse">
        <ul class="nav">
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://www.deekras.com/working-with-threads.html"><h1>Working with Threads</h1></a>
Sun 14 December 2014

by <a class="url fn" href="http://www.deekras.com/author/dee-kras.html">Dee Kras</a>
 


 
        </div>
        
        <div><h4>Working with Threads</h4>
<p>I've been encouraged to learn sockets and threading. It's been fun. With some frustrating moments when the book I am using and the docs are just not clear enough - for me.  So here I present it in a way that would ahve worked for me. So I share - in case it makes learning about threads easier for someone.</p>
<p><strong>First, a scenario where threading can be useful:</strong> You're using one of those websites that check several airlines for best fares.  Finally the trip to Barcelona!  It would take a long time to search each airline separately.  It woud be so much faster if the computer would search several airlines concurrently.  Thankfully, that is what they do - saving us much time.</p>
<p>That's exactly what threading does. The program sets off to do several things at the same time - each function on its own thread.  This is especially useful when the functions don't rely on or get data from each other.  Thread1 searches American Airlines, Thread2 searches Air France and Thread3 searches Iberia. And so on. And they each come back with their results when they are done.</p>
<p>So that's what threading does. Sure, that's oversimplified.  OK, I'm not sure how those flight aggregator programs really work, but that is a scenario where we'd see the benefits of threads.</p>
<p><strong>What's happening under the hood of threads?</strong></p>
<p>First some basic things to know:</p>
<ul>
<li>
<p>Threads execute parellel within the same process - and as such, they share all the same context (name space, address, etc.)</p>
</li>
<li>
<p>Threads have a beginning, the execution and an end.</p>
</li>
<li>
<p>locks</p>
</li>
</ul>
<p><strong>And here's how it all works - the pseudo code.</strong></p>
<ol>
<li>create the thread instances</li>
<li>execute the code</li>
<li>exit the thread and do whatever </li>
</ol>
<p>So in the case of the search for <strike> best tickets to Barcelona</strike>. Nah, that would be too much code; here is a much simpler scenario. Trying to find the local time in several places in the world. (Of course, there is no real need to thread for these queries, since they are super quick. But this will give an idea about how threading works.)</p>
<ol>
<li>
<p>Get the search query - what places we are looking for (country, city)</p>
<ul>
<li>these are hardcoded in a dictionary called <code>places</code>.</li>
<li>we'll use <code>www.timeapi.org</code> to find the local time for those places.</li>
</ul>
</li>
<li>
<p>Create a thread instance for each airline</p>
<ul>
<li>in a <code>for loop</code>, we will create a thread for each query.</li>
</ul>
</li>
<li>
<p>Execute the concurrent query searches.</p>
</li>
<li>
<p>When all query results come in, display the places and times on the screen.</p>
</li>
</ol>
<p>Here's the code:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">ctime</span>
<span class="kn">from</span> <span class="nn">atexit</span> <span class="kn">import</span> <span class="n">register</span>

<span class="n">url_lookup</span> <span class="o">=</span> <span class="s">&#39;http://www.timeapi.org/{}/now&#39;</span>

<span class="n">places</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Paris&#39;</span><span class="p">:</span> <span class="s">&#39;cet&#39;</span><span class="p">,</span>
            <span class="s">&#39;Moscow&#39;</span><span class="p">:</span> <span class="s">&#39;msk&#39;</span><span class="p">,</span>
            <span class="s">&#39;Kuwait&#39;</span><span class="p">:</span>  <span class="s">&#39;ast&#39;</span><span class="p">,</span>
            <span class="s">&#39;New York&#39;</span><span class="p">:</span> <span class="s">&#39;est&#39;</span><span class="p">,</span>
            <span class="s">&#39;Copenhagen&#39;</span><span class="p">:</span> <span class="s">&#39;cet&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">_display_time</span><span class="p">(</span><span class="n">place</span><span class="p">):</span>
    <span class="n">time_zone</span> <span class="o">=</span> <span class="n">places</span><span class="p">[</span><span class="n">place</span><span class="p">]</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_lookup</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_zone</span><span class="p">))</span><span class="o">.</span><span class="n">content</span>    
    <span class="k">print</span> <span class="s">&#39;{:&gt;10} | {:&lt;15}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">place</span><span class="p">,</span> <span class="n">current_time</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&#39;starting at:&#39;</span><span class="p">,</span> <span class="n">ctime</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span>
    <span class="k">for</span> <span class="n">place</span> <span class="ow">in</span> <span class="n">places</span><span class="p">:</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_display_time</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">place</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="nd">@register</span>
<span class="k">def</span> <span class="nf">_atexit</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span>
    <span class="k">print</span> <span class="s">&#39;all done at:&#39;</span><span class="p">,</span> <span class="n">ctime</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>First the imports.</p>
<p><code>url_lookup = 'http://www.timeapi.org/{}/now'</code>:
Then, the url that we'll use to find the time. Notice the curly braces <code>{}</code>. We'll use that later to insert the time_zone.</p>
<p><code>places</code>: This is a dictionary of places and time zones codes (as this API likes it). </p>
<p><code>def _display_time(place):</code>  This function 
1. gets the time zone (the value of the key <code>place</code>).
2. gets the current time - using the url with the time_zone inserted
    - uses the requests method. See more about <code>requests</code> in my ]previous post] and in the [docs]   (http://docs.python-requests.org/en/latest/).*</p></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://www.deekras.com/using-a-weather-api-forecastio.html"><h2>Using a weather api (forecast.io)</h2></a>
        <div class= "well small"> Sat 13 December 2014

by <a class="url fn" href="http://www.deekras.com/author/dee-kras.html">Dee Kras</a>
 


 </div>
        <div class="summary"><h4>Kinda cool to get the weather jsut the way I need it</h4>
<p>Moving along in discussing some of features of the little application I wrote.  </p>
<p>I already <a href="http://www.deekras.com/get-the-public-ip-of-users-computer.html">got the IP</a> and then <a href="http://www.deekras.com/finding-longitude-latitude-based-on-ip.html">found the longitude and latitude coordinates based on that IP</a>.</p>
<p>The next step is to find the local ...</p> <a class="btn btn-info xsmall" href="http://www.deekras.com/using-a-weather-api-forecastio.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://www.deekras.com/finding-longitude-latitude-based-on-ip.html"><h2>Finding Longitude & Latitude based on IP</h2></a>
        <div class= "well small"> Fri 12 December 2014

by <a class="url fn" href="http://www.deekras.com/author/dee-kras.html">Dee Kras</a>
 


 </div>
        <div class="summary"><h4>Once I had the IP, I needed to find the longitude &amp; latitude coordinates</h4>
<p>On that <a href="http://www.deekras.com/my-first-python-project-and-what-i-learned.html">recent project</a> I was working on, I was looking for the local weather based on where the user is located. So first, <a href="http://www.deekras.com/get-the-public-ip-of-users-computer.html">I got the IP</a>. With that IP, I used <strong>pygeoip.GeoIP</strong> to find ...</p> <a class="btn btn-info xsmall" href="http://www.deekras.com/finding-longitude-latitude-based-on-ip.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://www.deekras.com/get-the-public-ip-of-users-computer.html"><h2>Get the public IP of user's computer</h2></a>
        <div class= "well small"> Thu 11 December 2014

by <a class="url fn" href="http://www.deekras.com/author/dee-kras.html">Dee Kras</a>
 


 </div>
        <div class="summary"><h4>Here's how to get the IP</h4>
<p>For a <a href="http://www.deekras.com/my-first-python-project-and-what-i-learned.html">recent project</a>, I needed to get the longitude and latitude of where the user was at the time.  And from that data, I could get the local weather.</p>
<p>To do that, I'd find her local IP and then later use ...</p> <a class="btn btn-info xsmall" href="http://www.deekras.com/get-the-public-ip-of-users-computer.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://www.deekras.com/category/python.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://www.deekras.com/">Archives</a>
                <li><a href="http://www.deekras.com/tags.html">Tags</a>



                <li><a href="http://www.deekras.com/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>

            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://www.deekras.com/category/about.html">About</a></li>
                <li><a href="http://www.deekras.com/category/about-python.html">About  Python</a></li>
                <li><a href="http://www.deekras.com/category/python.html">Python</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://python.org/">Python.org</a></li>
                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="deekras">github</a></li>
                <li><a href="#">Another social link</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://www.deekras.com">DeeKras.com</a> &copy; Dee Kras 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
 
</body>
</html>